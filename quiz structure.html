<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grammar Quiz Application</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #5D5CDE;
            --primary-dark: #4A49B8;
            --secondary: #E6F0FF;
            --text-dark: #333;
            --text-light: #FFF;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .primary-btn {
            background-color: var(--primary);
            color: var(--text-light);
            transition: background-color 0.3s;
        }
        
        .primary-btn:hover {
            background-color: var(--primary-dark);
        }
        
        .primary-btn.selected {
            background-color: var(--primary-dark);
            color: var(--text-light);
            border: 2px solid var(--primary);
        }
        
        .option-btn {
            transition: all 0.2s;
        }
        
        .option-btn:hover {
            border-color: var(--primary);
        }
        
        .selected {
            background-color: var(--primary);
            color: var(--text-light);
        }
        
        .answered {
            background-color: #d1f5d3; /* Warna hijau muda untuk indikator soal terjawab */
            border-color: #4ade80; /* Warna border hijau */
        }
        
        /* Make sure selected takes precedence over answered */
        .option-btn.selected {
            background-color: var(--primary) !important;
            color: var(--text-light) !important;
            border-color: var(--primary-dark) !important;
        }
        
        .correct {
            background-color: #4ade80;
            color: var(--text-light);
        }
        
        .incorrect {
            background-color: #f87171;
            color: var(--text-light);
        }
        
        .progress-bar {
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--primary);
            transition: width 0.3s ease;
        }

        .loading-dots::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --secondary: #2d2d3a;
                --text-dark: #FFF;
            }
            
            body {
                background-color: #181818;
                color: var(--text-light);
            }
            
            .card {
                background-color: #252530;
            }
            
            .option-btn {
                background-color: #333340;
                border-color: #444450;
                color: var(--text-light);
            }
            
            .explanation-box {
                background-color: #333340;
            }
        }
        
        @media (prefers-color-scheme: light) {
            body {
                background-color: #FFFFFF;
                color: var(--text-dark);
            }
            
            .card {
                background-color: #FFFFFF;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }
            
            .option-btn {
                background-color: #FFFFFF;
                border-color: #e5e7eb;
                color: var(--text-dark);
            }
            
            .explanation-box {
                background-color: #f0f7ff;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Setup Screen -->
        <div id="setup-screen" class="card rounded-lg p-6 md:p-8 mb-8">
            <h1 class="text-2xl md:text-3xl font-bold text-center mb-6">Grammar Quiz</h1>
            <div class="flex flex-col space-y-6">
                <div>
                    <h2 class="text-xl font-semibold mb-3">Select Mode</h2>
                    <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                        <button id="test-mode-btn" class="primary-btn rounded-lg py-3 px-6 font-medium flex-1 flex items-center justify-center">
                            <span class="mr-2">üìù</span> Test Mode
                        </button>
                        <button id="study-mode-btn" class="primary-btn rounded-lg py-3 px-6 font-medium flex-1 flex items-center justify-center">
                            <span class="mr-2">üìö</span> Study Mode
                        </button>
                    </div>
                    <p class="mt-3 text-sm opacity-75">
                        <span class="font-semibold">Test Mode:</span> See explanations after completing all questions.<br>
                        <span class="font-semibold">Study Mode:</span> See explanations after each question.
                    </p>
                </div>
                
                <div>
                    <h2 class="text-xl font-semibold mb-3">Set Timer</h2>
                    <div class="flex items-center space-x-4">
                        <input id="timer-input" type="number" min="0" max="120" value="30" class="w-20 py-2 px-3 border rounded-lg text-center text-base focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <span>minutes</span>
                    </div>
                    <p class="mt-2 text-sm opacity-75">Set to 0 for no time limit</p>
                </div>
                
                <button id="start-quiz-btn" class="primary-btn rounded-lg py-3 px-6 font-medium mt-4 w-full">Start Quiz</button>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <div class="text-sm font-semibold">
                    <span id="mode-indicator" class="inline-block px-3 py-1 rounded-full bg-blue-100 text-blue-800">Test Mode</span>
                </div>
                <div id="timer-display" class="text-lg font-mono font-semibold">30:00</div>
            </div>
            
            <div class="progress-bar mb-6">
                <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
            </div>
            
            <div class="card rounded-lg p-5 md:p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">Question <span id="current-question">1</span> of <span id="total-questions">38</span></h2>
                </div>
                
                <p id="question-text" class="text-xl mb-6 leading-relaxed"></p>
                
                <div id="options-container" class="space-y-3 mb-6">
                    <!-- Options will be dynamically inserted here -->
                </div>
                
                <div id="explanation-container" class="hidden explanation-box p-4 rounded-lg mb-6">
                    <h3 class="font-semibold mb-2">Explanation</h3>
                    <p id="explanation-text" class="text-sm"></p>
                </div>
                
                <div class="flex justify-between">
                    <button id="prev-btn" class="py-2 px-4 rounded-lg border border-gray-300 hover:bg-gray-100 transition-colors">Previous</button>
                    <button id="finish-quiz-btn" class="primary-btn py-2 px-6 rounded-lg">Finish Quiz</button>
                    <button id="next-btn" class="primary-btn py-2 px-6 rounded-lg">Next</button>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="hidden">
            <div class="card rounded-lg p-6 md:p-8 mb-8">
                <h1 class="text-2xl md:text-3xl font-bold text-center mb-6">Quiz Results</h1>
                
                <div class="text-center mb-6">
                    <div class="text-4xl md:text-5xl font-bold mb-2"><span id="score">0</span>/<span id="max-score">38</span></div>
                    <p class="text-lg">Correct Answers</p>
                </div>
                
                <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-4">Time Taken</h2>
                    <p id="time-taken" class="text-lg">00:00</p>
                </div>
                
                <div id="review-container" class="space-y-6">
                    <!-- Question reviews will be inserted here -->
                </div>
                
                <div class="mt-8 flex justify-center">
                    <button id="restart-btn" class="primary-btn rounded-lg py-3 px-6 font-medium">Restart Quiz</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Quiz data
        const quizData = [
            {
                question: "________ Sarah drives to the cabin several times a year, she is often nervous about finding her way.",
                options: ["a. Besides","b. Unless","c. Nevertheless","d. Although"],
                correctAnswer: 3,
                explanation: "d. Although means 'despite the fact that' or 'even though.' Even though Sarah drives to the cabin all the time, she still gets nervous. The other choices do not convey this meaning."
            },
            {
                question: "Lila wasn't feeling well. _____________, she decided to stay home from work.",
                options: ["a. Therefore","b. Meanwhile","c. However","d. Anyway"],
                correctAnswer: 0,
                explanation: "a. Therefore best completes the sentence's meaning; it creates a cause and effect relationship between how Lila is feeling (the cause) and her decision to stay home from work (the effect)."
            },
            {
                question: "___________ he waited for the doctor to call him in, Sam sat in the waiting room and read the newspaper. ",
                options: ["a. So that","b. While","c. Even if","d. Besides when"],
                correctAnswer: 1,
                explanation: "b. While suggests that two things are happening simultaneously; it is the only logical choice. Choice a implies that Sam could control when the doctor called him in. Choices c and d are unclear."
            },
            {
                question: "Ruby loves blueberry pie _________ it is made with freshly picked blueberries.",
                options: ["a. whether","b. because","c. when","d. as if"],
                correctAnswer: 2,
                explanation: "c. The sentence requires a condition--Ruby likes blueberry pie on one condition: freshly picked blueberries. Choice b can be ruled out because blueberry pie is not always made with freshly picked blueberries. Choices a and d result in unclear sentences."
            },
            {
                question: "Mitchell loves listening to jazz and rhythm and blues. Greg, ____________, will only listen to country. ",
                options: ["a. however","b. then","c. too","d. therefore"],
                correctAnswer: 0,
                explanation: "a. However indicates an impending contradiction; it is the best choice because the two clauses compare musical tastes. In this case, the comparison contrasts Mitchell's preference to Greg's."
            },
            {
                question: "__________ our low annual fee, you will receive a 20% discount if you sign up this week.",
                options: ["a. Because","b. While","c. In spite of","d. In addition to"],
                correctAnswer: 3,
                explanation: "d. If you rearrange the sentence, it would read: If you sign up this week, you will receive a low annual fee and a 20% discount. In addition means 'and'; it is the best choice. Choices a, b, and c result in an awkward construction."
            },
            {
                question: "The ticket said the show would start at 8:00, but the curtains didn't go up _________ 8:30. ",
                options: ["a. less than","b. until","c. about","d. since"],
                correctAnswer: 1,
                explanation: "b. The two clauses make a reference to time--more specifically, to two different times. Choice b is the only logical response."
            },
            {
                question: "My neighbor is deathly afraid of dogs; ___________, I never let my Golden Retriever, Sandy, outside without a leash.",
                options: ["a. moreover","b. yet","c. mainly","d. consequently"],
                correctAnswer: 3,
                explanation: "d. The golden retriever is never outside without a leash because the neighbor is afraid of dogs; one is the effect of the other. Consequently means 'following as an effect or as a result.' This is the best choice."
            },
            {
                question: "The wedding quilt was designed as a sentimental way to make use of fabric taken ______________ blankets and bedding that belonged to older couples in her family. ",
                options: ["a. from","b. with","c. in","d. at"],
                correctAnswer: 0,
                explanation: "a. This sentence speculates that quilts were made from fabrics taken from somewhere. Only 'from' completes this idea."
            },
            {
                question: "Sandra Day O'Connor, the first woman to serve on the U.S. Supreme Court, ________ appointed by President Ronald Reagan in 1981. ",
                options: ["a. she","b. and","c. but","d. was"],
                correctAnswer: 3,
                explanation: "d. This is the only choice that results in a complete and logical sentence. Choice a is illogical; choices b and c result in sentence fragments."
            },
            {
                question: "I ________ the speech you gave last Thursday night, but I was in bed with the flu. ",
                options: ["a. will have heard","b. would hear","c. might hear","d. would have heard"],
                correctAnswer: 3,
                explanation: "d. The conditional tense, 'would have heard,' is the only one that logically fits with the second clause of the sentence."
            },
            {
                question: "________ the Beatles' most popular songs-- most of which were written by Lennon and Mc Cartney--are 'I Want to Hold Your Hand' and 'Hey, Jude.' ",
                options: ["a. With","b. Considering","c. Among","d. To"],
                correctAnswer: 2,
                explanation: "c. The Beatles songs specifically named were pulled from a pool of titles. Only 'Among' suggests the existence of many other things, in this case songs."
            },
            {
                question: "On March 15, 2006, the Maywood Recreation Department requested a grant from the state to rebuild the community center that _________________ in the recent fire.",
                options: ["a. destroys","b. will be destroyed","c. had been destroyed","d. is being destroyed"],
                correctAnswer: 2,
                explanation: "c. The sentence requires a verb in the past tense."
            },
            {
                question: "Matthew Morris and Jessica Glassman hosted a holiday party that The River Bank Caf√© _________________. ",
                options: ["a. caters","b. will cater","c. is catering","d. catered"],
                correctAnswer: 3,
                explanation: "d. The sentence requires a verb in the past tense."
            },
            {
                question: "Megan is trying to read all three books in the series before summer ____________. ",
                options: ["a. ended","b. will have ended","c. will end","d. ends"],
                correctAnswer: 3,
                explanation: "d. The appropriate tense for this verb is the present tense."
            },
            {
                question: "We have ______________ more sweets since that wonderful bakery opened down the block. ",
                options: ["a. ate","b. been eating","c. been eat","d. eat"],
                correctAnswer: 1,
                explanation: "b. The verbal form 'been eating' fits with the verb 'have.'"
            },
            {
                question: "While attempting to _____________ his broken bicycle, Leo Donner realized that he didn't have the proper tools. ",
                options: ["a. be repairing","b. have repaired","c. repair","d. repaired"],
                correctAnswer: 2,
                explanation: "c. The infinitive form of the verb 'repair' goes with 'to' in the sentence."
            },
            {
                question: "___________ the police immediately. ",
                options: ["a. Call","b. Called","c. Been calling","d. To call"],
                correctAnswer: 0,
                explanation: "a. This is a command; the subject of the sentence is understood (You call)."
            },
            {
                question: "The biggest problem with Martha's garden __________ too many weeds. ",
                options: ["a. will have been","b. were","c. will have","d. was"],
                correctAnswer: 3,
                explanation: "d. The verb 'was' agrees with its subject, 'problem,' and is in the past tense."
            },
            {
                question: "Last week, Tracy and Shane were honored at a luncheon for their part in rescuing a child who ____________________ into an icy pond. ",
                options: ["a. falls","b. would fall","c. had fallen","d. has fallen"],
                correctAnswer: 2,
                explanation: "c. Since the action takes place in the past, the only correct choice is the past perfect 'had fallen.'"
            },
            {
                question: "The woman who confronted the owner of the unleashed dog ____________ angry. ",
                options: ["a. were","b. was","c. are","d. have been"],
                correctAnswer: 1,
                explanation: "b. This is the only choice that is in agreement with the singular subject 'woman.'"
            },
            {
                question: "The boy ______________ the bat and ran to first base as fast as he could. ",
                options: ["a. swings","b. swinged","c. swung","d. swing"],
                correctAnswer: 2,
                explanation: "c. The correct verb form is the past tense 'swung.'"
            },
            {
                question: "There ___________ four excellent restaurants in the center of town. ",
                options: ["a. is","b. are","c. was","d. being"],
                correctAnswer: 1,
                explanation: "b. The verb 'are' agrees with the plural noun 'restaurants.'"
            },
            {
                question: "The noise from the lawn mowers ______________ louder as the morning progresses. ",
                options: ["a. gets","b. get","c. have gotten","d. are getting"],
                correctAnswer: 0,
                explanation: "a. The singular verb 'gets' agrees with the singular noun 'noise.'"
            },
            {
                question: "That fine circus elephant now belongs to my sister and ________. ",
                options: ["a. I","b. me","c. mine","d. myself"],
                correctAnswer: 1,
                explanation: "b. The correct form of the pronoun is 'me' (objective case)."
            },
            {
                question: "The person ________ made these delicious candied figs has my vote. ",
                options: ["a. that","b. whom","c. who","d. whose"],
                correctAnswer: 2,
                explanation: "c. The correct pronoun is 'who,' because it refers to a person, and it is the subject form of 'who' (not the object form, 'whom'), because 'who' is doing something, making candied figs."
            },
            {
                question: "If you don't stop playing ________ video games, you will miss the bus. ",
                options: ["a. that","b. those","c. them","d. this"],
                correctAnswer: 1,
                explanation: "b. The pronoun agrees in number with the noun to which it refers."
            },
            {
                question: "George and Michael left ________ backpacks at school.",
                options: ["a. his","b. their","c. there","d. its"],
                correctAnswer: 1,
                explanation: "b. The antecedent, 'George and Michael,' is plural, so the plural pronoun 'their' is the correct choice."
            },
            {
                question: "If you steal ________ artichoke from Petra's garden, you'll be sorry.",
                options: ["a. them","b. those","c. that","d. these"],
                correctAnswer: 2,
                explanation: "c. The pronoun 'that' agrees in number with the noun to which it refers, 'artichoke.'"
            },
            {
                question: "We arranged the flowers and placed ________ in the center of the table. ",
                options: ["a. it","b. this","c. them","d. that"],
                correctAnswer: 2,
                explanation: "c. The pronoun 'them' agrees with the plural noun 'flowers.'"
            },
            {
                question: "________ met more than ten years ago at a mutual friend's birthday party. ",
                options: ["a. Her and I","b. Her and me","c. She and me","d. She and I"],
                correctAnswer: 3,
                explanation: "d. 'She and I' is the subject of the sentence, so the subjective case is needed."
            },
            {
                question: "My parents approved of ________ taking guitar lessons. ",
                options: ["a. my","b. me","c. I","d. mine"],
                correctAnswer: 0,
                explanation: "a. The possessive case is used before the word 'taking,' because it functions like a noun in this sentence."
            },
            {
                question: "In many popular movies today, the heroes are ________ armed than the villains. ",
                options: ["a. more heavily","b. more heavy","c. heavier","d. more heavier"],
                correctAnswer: 0,
                explanation: "a. The missing phrase modifies the verb 'are armed' and creates a comparison between two types of people, heroes and villains. Therefore, you need a comparative form of the adverb 'heavily.'"
            },
            {
                question: "The cake I made last week tasted ________ than the one I made today. ",
                options: ["a. best","b. more better","c. better","d. more good"],
                correctAnswer: 2,
                explanation: "c. The comparison is between two things, a cake made last week and a cake made this week; choices a and d can be ruled out. Choice b, 'more better,' is redundant. Choice c, 'better,' is the best choice to make the comparison."
            },
            {
                question: "After winning the yo-yo contest, Lydia skipped ________ down the street. ",
                options: ["a. happy","b. happiest","c. more happily","d. happily"],
                correctAnswer: 3,
                explanation: "d. The missing phrase modifies the verb; therefore the sentence requires an adverb. Choices a and b are adjectives and can be ruled out. Choice c makes an unnecessary comparison."
            },
            {
                question: "Of the three brothers, Andre is the ________. ",
                options: ["a. taller","b. tallest","c. more tall","d. most tallest"],
                correctAnswer: 1,
                explanation: "b. The comparison is being made among three brothers; therefore, this sentence requires a superlative. Choices a and c only compare two things, and choice d is redundant."
            },
            {
                question: "Riding the Tornado at the amusement park was ________ than I thought it would be. ",
                options: ["a. more terrifying","b. more terrifyingly","c. terrifying","d. most terrifying"],
                correctAnswer: 0,
                explanation: "a. The missing phrase modifies a noun and makes a comparison between two things, what he thought and what it was; therefore the sentence requires a comparative adjective. Choice b is an adverb. Choice c does not make a comparison, and choice d is a superlative, a comparison of three or more things. Choice a, 'more terrifying,' is the best choice."
            },
            {
                question: "This year our company sold ________ magazine subscriptions than ever before. ",
                options: ["a. less","b. lesser","c. few","d. fewer"],
                correctAnswer: 3,
                explanation: "d. Use 'fewer' with nouns that can be counted."
            }
        ];

        // Application state
        let currentState = {
            mode: null, // 'test' or 'study'
            timerDuration: 30, // minutes
            currentQuestion: 0,
            answers: Array(quizData.length).fill(null),
            timerInterval: null,
            startTime: null,
            remainingTime: null,
            completed: false
        };

        // DOM Elements
        const setupScreen = document.getElementById('setup-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultsScreen = document.getElementById('results-screen');
        const testModeBtn = document.getElementById('test-mode-btn');
        const studyModeBtn = document.getElementById('study-mode-btn');
        const timerInput = document.getElementById('timer-input');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const modeIndicator = document.getElementById('mode-indicator');
        const timerDisplay = document.getElementById('timer-display');
        const currentQuestionEl = document.getElementById('current-question');
        const totalQuestionsEl = document.getElementById('total-questions');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const explanationContainer = document.getElementById('explanation-container');
        const explanationText = document.getElementById('explanation-text');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const finishBtn = document.getElementById('finish-quiz-btn');
        const progressFill = document.getElementById('progress-fill');
        const scoreEl = document.getElementById('score');
        const maxScoreEl = document.getElementById('max-score');
        const timeTakenEl = document.getElementById('time-taken');
        const reviewContainer = document.getElementById('review-container');
        const restartBtn = document.getElementById('restart-btn');

        // Event Listeners
        testModeBtn.addEventListener('click', () => selectMode('test'));
        studyModeBtn.addEventListener('click', () => selectMode('study'));
        startQuizBtn.addEventListener('click', startQuiz);
        prevBtn.addEventListener('click', goToPreviousQuestion);
        nextBtn.addEventListener('click', goToNextQuestion);
        finishBtn.addEventListener('click', finishQuiz);
        restartBtn.addEventListener('click', resetQuiz);

        // Functions
        function selectMode(mode) {
            currentState.mode = mode;
            
            // Hapus kelas 'selected' dari kedua tombol
            testModeBtn.classList.remove('selected');
            studyModeBtn.classList.remove('selected');
            
            // Tambahkan kelas 'selected' ke tombol yang diklik
            if (mode === 'test') {
                testModeBtn.classList.add('selected');
                modeIndicator.textContent = 'Test Mode';
                modeIndicator.classList.remove('bg-green-100', 'text-green-800');
                modeIndicator.classList.add('bg-blue-100', 'text-blue-800');
            } else {
                studyModeBtn.classList.add('selected');
                modeIndicator.textContent = 'Study Mode';
                modeIndicator.classList.remove('bg-blue-100', 'text-blue-800');
                modeIndicator.classList.add('bg-green-100', 'text-green-800');
            }
        }

        function startQuiz() {
            if (!currentState.mode) {
                alert('Please select a mode first!');
                return;
            }
            
            currentState.timerDuration = parseInt(timerInput.value) || 0;
            currentState.remainingTime = currentState.timerDuration * 60; // convert to seconds
            currentState.startTime = new Date();
            
            setupScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            
            totalQuestionsEl.textContent = quizData.length;
            maxScoreEl.textContent = quizData.length;
            
            loadQuestion(0);
            updateProgressBar();
            
            if (currentState.timerDuration > 0) {
                startTimer();
            } else {
                timerDisplay.textContent = 'No time limit';
            }
        }

        function loadQuestion(index) {
            if (index < 0 || index >= quizData.length) return;
            
            currentState.currentQuestion = index;
            currentQuestionEl.textContent = index + 1;
            
            const question = quizData[index];
            questionText.textContent = question.question;
            
            optionsContainer.innerHTML = '';
            question.options.forEach((option, i) => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'option-btn w-full text-left p-3 rounded-lg border';
                optionBtn.textContent = option;
                optionBtn.dataset.index = i;

                // Add visual indicator for answered questions
                if (currentState.answers[index] === i) {
                    optionBtn.classList.add('selected');
                } else if (currentState.answers[index] !== null && currentState.mode === 'test') {
                    optionBtn.classList.add('answered');
                }

                optionBtn.addEventListener('click', () => selectAnswer(i));
                optionsContainer.appendChild(optionBtn);
            });

            prevBtn.disabled = index === 0;

            // Enable Next button if an answer is selected
            nextBtn.disabled = currentState.answers[index] === null;
            explanationContainer.classList.add('hidden');

            if (currentState.mode === 'study' && currentState.answers[index] !== null) {
                showExplanation();
            }
        }

        function selectAnswer(optionIndex) {
            const currentIndex = currentState.currentQuestion;
            currentState.answers[currentIndex] = optionIndex;

            const options = optionsContainer.querySelectorAll('.option-btn');
            options.forEach((option, i) => {
                // Clear any existing selected/answered classes first
                option.classList.remove('selected');
                
                // Add selected class to the chosen option
                if (i === optionIndex) {
                    option.classList.add('selected');
                }
            });

            nextBtn.disabled = false;

            if (currentState.mode === 'study') {
                showExplanation();
            }
        }

        function showExplanation() {
            const currentIndex = currentState.currentQuestion;
            const question = quizData[currentIndex];
            const selectedAnswer = currentState.answers[currentIndex];
            
            explanationText.textContent = question.explanation;
            explanationContainer.classList.remove('hidden');
            
            const options = optionsContainer.querySelectorAll('.option-btn');
            options.forEach((option, i) => {
                option.classList.remove('correct', 'incorrect');
                if (i === question.correctAnswer) {
                    option.classList.add('correct');
                } else if (i === selectedAnswer && selectedAnswer !== question.correctAnswer) {
                    option.classList.add('incorrect');
                }
            });
        }

        function goToPreviousQuestion() {
            loadQuestion(currentState.currentQuestion - 1);
            updateProgressBar();
        }

        function goToNextQuestion() {
            const currentIndex = currentState.currentQuestion;
            
            if (currentIndex === quizData.length - 1) {
                finishQuiz();
                return;
            }
            
            loadQuestion(currentIndex + 1);
            updateProgressBar();
        }

        function updateProgressBar() {
            const percentage = ((currentState.currentQuestion + 1) / quizData.length) * 100;
            progressFill.style.width = `${percentage}%`;
        }

        function startTimer() {
            updateTimerDisplay();
            currentState.timerInterval = setInterval(() => {
                currentState.remainingTime--;
                updateTimerDisplay();
                
                if (currentState.remainingTime <= 0) {
                    clearInterval(currentState.timerInterval);
                    finishQuiz();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(currentState.remainingTime / 60);
            const seconds = currentState.remainingTime % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function calculateScore() {
            return currentState.answers.reduce((score, answer, index) => {
                return answer === quizData[index].correctAnswer ? score + 1 : score;
            }, 0);
        }

        function calculateTimeTaken() {
            if (currentState.timerDuration === 0) {
                const endTime = new Date();
                const timeDiff = Math.floor((endTime - currentState.startTime) / 1000); // in seconds
                const minutes = Math.floor(timeDiff / 60);
                const seconds = timeDiff % 60;
                return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            } else {
                const timeUsed = (currentState.timerDuration * 60) - currentState.remainingTime;
                const minutes = Math.floor(timeUsed / 60);
                const seconds = timeUsed % 60;
                return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        function finishQuiz() {
            clearInterval(currentState.timerInterval);
            currentState.completed = true;
            
            quizScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');
            
            scoreEl.textContent = calculateScore();
            timeTakenEl.textContent = calculateTimeTaken();
            
            renderReviewQuestions();
        }

        function renderReviewQuestions() {
            reviewContainer.innerHTML = '';
            
            quizData.forEach((question, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'p-4 border rounded-lg';
                
                const isCorrect = currentState.answers[index] === question.correctAnswer;
                questionCard.classList.add(isCorrect ? 'border-green-300' : 'border-red-300');
                
                const header = document.createElement('div');
                header.className = 'flex items-center mb-2';
                
                const statusIndicator = document.createElement('span');
                statusIndicator.className = 'inline-block w-4 h-4 rounded-full mr-2';
                statusIndicator.classList.add(isCorrect ? 'bg-green-500' : 'bg-red-500');
                header.appendChild(statusIndicator);
                
                const questionNumber = document.createElement('span');
                questionNumber.className = 'font-semibold';
                questionNumber.textContent = `Question ${index + 1}`;
                header.appendChild(questionNumber);
                
                questionCard.appendChild(header);
                
                const questionContent = document.createElement('p');
                questionContent.className = 'mb-3';
                questionContent.textContent = question.question;
                questionCard.appendChild(questionContent);
                
                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'mb-3 space-y-2';
                
                question.options.forEach((option, i) => {
                    const optionItem = document.createElement('div');
                    optionItem.className = 'flex items-center p-2 rounded';
                    
                    if (i === question.correctAnswer) {
                        optionItem.classList.add('bg-green-100');
                    } else if (i === currentState.answers[index] && i !== question.correctAnswer) {
                        optionItem.classList.add('bg-red-100');
                    }
                    
                    const optionText = document.createElement('span');
                    optionText.textContent = option;
                    optionItem.appendChild(optionText);
                    
                    if (i === question.correctAnswer) {
                        const checkIcon = document.createElement('span');
                        checkIcon.className = 'ml-auto text-green-600';
                        checkIcon.textContent = '‚úì';
                        optionItem.appendChild(checkIcon);
                    } else if (i === currentState.answers[index] && i !== question.correctAnswer) {
                        const crossIcon = document.createElement('span');
                        crossIcon.className = 'ml-auto text-red-600';
                        crossIcon.textContent = '‚úó';
                        optionItem.appendChild(crossIcon);
                    }
                    
                    optionsDiv.appendChild(optionItem);
                });
                
                questionCard.appendChild(optionsDiv);
                
                const explanationDiv = document.createElement('div');
                explanationDiv.className = 'explanation-box p-3 rounded text-sm';
                explanationDiv.textContent = question.explanation;
                questionCard.appendChild(explanationDiv);
                
                reviewContainer.appendChild(questionCard);
            });
        }

        function resetQuiz() {
            currentState = {
                mode: null,
                timerDuration: 30,
                currentQuestion: 0,
                answers: Array(quizData.length).fill(null),
                timerInterval: null,
                startTime: null,
                remainingTime: null,
                completed: false
            };
            
            clearInterval(currentState.timerInterval);
            
            resultsScreen.classList.add('hidden');
            setupScreen.classList.remove('hidden');
            
            testModeBtn.classList.remove('selected');
            studyModeBtn.classList.remove('selected');
            timerInput.value = 30;
        }

        // Initialize the application
        function init() {
            totalQuestionsEl.textContent = quizData.length;
            maxScoreEl.textContent = quizData.length;
        }

        init();
    </script>
</body>
</html>
